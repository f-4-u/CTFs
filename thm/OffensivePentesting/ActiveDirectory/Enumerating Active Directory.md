---
tags:
  - THM
  - AD
  - Pentesting
---
# Enumerating Active Directory

## Prepare

`sudo vim /etc/resolve.conf`

```bash
# Generated by NetworkManager
search za.tryhackme.com
nameserver 10.200.14.101 
nameserver 9.9.9.9
# Shorten name resolution timeouts to 1 second
options timeout:1
# Only attempt to resolve a hostname 2 times
options attempts:2
```

## Task 3

```bash
export THMDCIP=10.200.14.101
systemd-resolve --interface enumad --set-dns $THMDCIP --set-domain za.tryhackme.com
ping -c2 $THMDCIP
nslookup thmdc.za.tryhackme.com
```

> <http://distributor.za.tryhackme.com/creds> to get creds
> Your credentials have been generated: Username: andrea.mitchell Password: Password1

```bash
export user=leon.jennings
export pass=Password!
export dom=za.tryhackme.com
```

`ssh ${user}@${dom}@thmjmp1.${dom}`

````shell
xfreerdp /d:$dom /u:$user /p:$pass /v:thmjmp1.$dom /drive:.,kali-share +clipboard
````

## Task 4

```powershell
$dnsip = "10.200.14.101"
$index = Get-NetAdapter -Name 'Ethernet 4' | Select-Object -ExpandProperty 'ifIndex'
Set-DnsClientServerAddress -InterfaceIndex $index -ServerAddresses $dnsip
```

```powershell
net user aaron.harris /domain
The request will be processed at a domain controller for domain za.tryhackme.com.

User name                    aaron.harris
Full Name                    Aaron Harris
Comment
User's comment
Country/region code          000 (System Default)
Account active               Yes
Account expires              Never

Password last set            2/24/2022 11:05:11 PM
Password expires             Never
Password changeable          2/24/2022 11:05:11 PM
Password required            Yes
User may change password     Yes

Workstations allowed         All
Logon script
User profile
Home directory
Last logon                   Never

Logon hours allowed          All

Local Group Memberships
Global Group memberships     *Domain Users         *Internet Access
The command completed successfully.
```

```powershell
 net group "Tier 1 Admins" /domain
The request will be processed at a domain controller for domain za.tryhackme.com.

Group name     Tier 1 Admins
Comment

Members

-------------------------------------------------------------------------------
t1_arthur.tyler          t1_gary.moss             t1_henry.miller
t1_jill.wallis           t1_joel.stephenson       t1_marian.yates
t1_rosie.bryant
The command completed successfully.
```

```powershell
 net accounts /domain
The request will be processed at a domain controller for domain za.tryhackme.com.

Force user logoff how long after time expires?:       Never
Minimum password age (days):                          0
Maximum password age (days):                          Unlimited
Minimum password length:                              0
Length of password history maintained:                None
Lockout threshold:                                    Never
Lockout duration (minutes):                           30
Lockout observation window (minutes):                 30
Computer role:                                        PRIMARY
The command completed successfully.
```

## Task 5

> `Get-ADUser -Identity beth.nolan -Server za.tryhackme.com -Properties *`
>
> Senior

>`Get-ADUser -Identity annette.manning -Server za.tryhackme.com -Properties *`
> CN=annette.manning,OU=Marketing,OU=People,DC=za,DC=tryhackme,DC=com

> `Get-ADGroup -Identity "Tier 2 Admins" -Server za.tryhackme.com -Properties *`
>
> 2/24/2022 10:04:41 PM

> `Get-ADGroup -Identity "Enterprise Admins" -Server za.tryhackme.com -Properties *`
>
> S-1-5-21-3330634377-1326264276-632209373-519

> `Get-ADDomain -Server za.tryhackme.com`
>
> CN=Deleted Objects,DC=za,DC=tryhackme,DC=com

## Task 6

```bash
neo4j console start

bloodhound --no-sandbox #neo4j:neo4j


scp -r $user@THMJMP1.$dom$:C:/Users/$user/Documents/ .
```
